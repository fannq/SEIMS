<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.7.6.1"/>
        
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

        <title>SEIMS-2016: preprocess/cpp_src/metis-5.1.0-pk/libmetis/coarsen.c Source File</title>
        
        <!--<link href="$relpath^tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="$relpath^dynsections.js"></script>
        
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

        <link href="$relpath^doxygen.css" rel="stylesheet" type="text/css" />
        $extrastylesheet

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="$relpath^doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">SEIMS-2016 1.0-beta</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">preprocess/cpp_src/metis-5.1.0-pk/libmetis/coarsen.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="coarsen_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;metislib.h&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#define UNMATCHEDFOR2HOP  0.10  </span><span class="comment">/* The fraction of unmatched vertices that triggers 2-hop */</span>
<a name="l00015"></a>00015                                   
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/*************************************************************************/</span>
<a name="l00021"></a>00021 <span class="comment">/*************************************************************************/</span>
<a name="l00022"></a><a class="code" href="coarsen_8c.html#adeb2c7c9bffbeca00fcc97854fb88ada">00022</a> <a class="code" href="structgraph__t.html">graph_t</a> *<a class="code" href="coarsen_8c.html#adeb2c7c9bffbeca00fcc97854fb88ada">CoarsenGraph</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph)
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024   idx_t i, eqewgts, level=0;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;CoarsenTmr));
<a name="l00027"></a>00027 
<a name="l00028"></a>00028   <span class="comment">/* determine if the weights on the edges are all the same */</span>
<a name="l00029"></a>00029   <span class="keywordflow">for</span> (eqewgts=1, i=1; i&lt;graph-&gt;nedges; i++) {
<a name="l00030"></a>00030     <span class="keywordflow">if</span> (graph-&gt;adjwgt[0] != graph-&gt;adjwgt[i]) {
<a name="l00031"></a>00031       eqewgts = 0;
<a name="l00032"></a>00032       <span class="keywordflow">break</span>;
<a name="l00033"></a>00033     }
<a name="l00034"></a>00034   }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   <span class="comment">/* set the maximum allowed coarsest vertex weight */</span>
<a name="l00037"></a>00037   <span class="keywordflow">for</span> (i=0; i&lt;graph-&gt;ncon; i++)
<a name="l00038"></a>00038     ctrl-&gt;maxvwgt[i] = 1.5*graph-&gt;tvwgt[i]/ctrl-&gt;CoarsenTo;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="keywordflow">do</span> {
<a name="l00041"></a>00041     IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877ac9797cd41298d036deab380e088b1b05">METIS_DBG_COARSEN</a>, <a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">PrintCGraphStats</a>(ctrl, graph));
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     <span class="comment">/* allocate memory for cmap, if it has not already been done due to</span>
<a name="l00044"></a>00044 <span class="comment">       multiple cuts */</span>
<a name="l00045"></a>00045     <span class="keywordflow">if</span> (graph-&gt;cmap == NULL)
<a name="l00046"></a>00046       graph-&gt;cmap = imalloc(graph-&gt;nvtxs, <span class="stringliteral">&quot;CoarsenGraph: graph-&gt;cmap&quot;</span>);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048     <span class="comment">/* determine which matching scheme you will use */</span>
<a name="l00049"></a>00049     <span class="keywordflow">switch</span> (ctrl-&gt;ctype) {
<a name="l00050"></a>00050       <span class="keywordflow">case</span> METIS_CTYPE_RM:
<a name="l00051"></a>00051         <a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">Match_RM</a>(ctrl, graph);
<a name="l00052"></a>00052         <span class="keywordflow">break</span>;
<a name="l00053"></a>00053       <span class="keywordflow">case</span> METIS_CTYPE_SHEM:
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (eqewgts || graph-&gt;nedges == 0)
<a name="l00055"></a>00055           <a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">Match_RM</a>(ctrl, graph);
<a name="l00056"></a>00056         <span class="keywordflow">else</span>
<a name="l00057"></a>00057           <a class="code" href="coarsen_8c.html#af3ec72f3170ccdca06d8ad018d86cc58">Match_SHEM</a>(ctrl, graph);
<a name="l00058"></a>00058         <span class="keywordflow">break</span>;
<a name="l00059"></a>00059       <span class="keywordflow">default</span>:
<a name="l00060"></a>00060         <a class="code" href="error_8c.html#a4c320c13bcdc9967613253ef4c73f59f">gk_errexit</a>(SIGERR, <span class="stringliteral">&quot;Unknown ctype: %d\n&quot;</span>, ctrl-&gt;ctype);
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     graph = graph-&gt;coarser;
<a name="l00064"></a>00064     eqewgts = 0;
<a name="l00065"></a>00065     level++;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     ASSERT(CheckGraph(graph, 0, 1));
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   } <span class="keywordflow">while</span> (graph-&gt;nvtxs &gt; ctrl-&gt;CoarsenTo &amp;&amp; 
<a name="l00070"></a>00070            graph-&gt;nvtxs &lt; COARSEN_FRACTION*graph-&gt;finer-&gt;nvtxs &amp;&amp; 
<a name="l00071"></a>00071            graph-&gt;nedges &gt; graph-&gt;nvtxs/2);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877ac9797cd41298d036deab380e088b1b05">METIS_DBG_COARSEN</a>, <a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">PrintCGraphStats</a>(ctrl, graph));
<a name="l00074"></a>00074   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;CoarsenTmr));
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordflow">return</span> graph;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/*************************************************************************/</span>
<a name="l00084"></a>00084 <span class="comment">/*************************************************************************/</span>
<a name="l00085"></a><a class="code" href="coarsen_8c.html#afa83320e3b311e0feef90d0bf4303716">00085</a> <a class="code" href="structgraph__t.html">graph_t</a> *<a class="code" href="coarsen_8c.html#afa83320e3b311e0feef90d0bf4303716">CoarsenGraphNlevels</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t nlevels)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087   idx_t i, eqewgts, level;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;CoarsenTmr));
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="comment">/* determine if the weights on the edges are all the same */</span>
<a name="l00092"></a>00092   <span class="keywordflow">for</span> (eqewgts=1, i=1; i&lt;graph-&gt;nedges; i++) {
<a name="l00093"></a>00093     <span class="keywordflow">if</span> (graph-&gt;adjwgt[0] != graph-&gt;adjwgt[i]) {
<a name="l00094"></a>00094       eqewgts = 0;
<a name="l00095"></a>00095       <span class="keywordflow">break</span>;
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="comment">/* set the maximum allowed coarsest vertex weight */</span>
<a name="l00100"></a>00100   <span class="keywordflow">for</span> (i=0; i&lt;graph-&gt;ncon; i++)
<a name="l00101"></a>00101     ctrl-&gt;maxvwgt[i] = 1.5*graph-&gt;tvwgt[i]/ctrl-&gt;CoarsenTo;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   for (level=0; level&lt;nlevels; level++) {
<a name="l00104"></a>00104     IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877ac9797cd41298d036deab380e088b1b05">METIS_DBG_COARSEN</a>, <a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">PrintCGraphStats</a>(ctrl, graph));
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="comment">/* allocate memory for cmap, if it has not already been done due to</span>
<a name="l00107"></a>00107 <span class="comment">       multiple cuts */</span>
<a name="l00108"></a>00108     <span class="keywordflow">if</span> (graph-&gt;cmap == NULL)
<a name="l00109"></a>00109       graph-&gt;cmap = imalloc(graph-&gt;nvtxs, <span class="stringliteral">&quot;CoarsenGraph: graph-&gt;cmap&quot;</span>);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="comment">/* determine which matching scheme you will use */</span>
<a name="l00112"></a>00112     <span class="keywordflow">switch</span> (ctrl-&gt;ctype) {
<a name="l00113"></a>00113       <span class="keywordflow">case</span> METIS_CTYPE_RM:
<a name="l00114"></a>00114         <a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">Match_RM</a>(ctrl, graph);
<a name="l00115"></a>00115         <span class="keywordflow">break</span>;
<a name="l00116"></a>00116       <span class="keywordflow">case</span> METIS_CTYPE_SHEM:
<a name="l00117"></a>00117         <span class="keywordflow">if</span> (eqewgts || graph-&gt;nedges == 0)
<a name="l00118"></a>00118           <a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">Match_RM</a>(ctrl, graph);
<a name="l00119"></a>00119         <span class="keywordflow">else</span>
<a name="l00120"></a>00120           <a class="code" href="coarsen_8c.html#af3ec72f3170ccdca06d8ad018d86cc58">Match_SHEM</a>(ctrl, graph);
<a name="l00121"></a>00121         <span class="keywordflow">break</span>;
<a name="l00122"></a>00122       <span class="keywordflow">default</span>:
<a name="l00123"></a>00123         <a class="code" href="error_8c.html#a4c320c13bcdc9967613253ef4c73f59f">gk_errexit</a>(SIGERR, <span class="stringliteral">&quot;Unknown ctype: %d\n&quot;</span>, ctrl-&gt;ctype);
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     graph = graph-&gt;coarser;
<a name="l00127"></a>00127     eqewgts = 0;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     ASSERT(CheckGraph(graph, 0, 1));
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (graph-&gt;nvtxs &lt; ctrl-&gt;CoarsenTo || 
<a name="l00132"></a>00132         graph-&gt;nvtxs &gt; COARSEN_FRACTION*graph-&gt;finer-&gt;nvtxs || 
<a name="l00133"></a>00133         graph-&gt;nedges &lt; graph-&gt;nvtxs/2)
<a name="l00134"></a>00134       <span class="keywordflow">break</span>; 
<a name="l00135"></a>00135   } 
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877ac9797cd41298d036deab380e088b1b05">METIS_DBG_COARSEN</a>, <a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">PrintCGraphStats</a>(ctrl, graph));
<a name="l00138"></a>00138   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;CoarsenTmr));
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   <span class="keywordflow">return</span> graph;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">/*************************************************************************/</span>
<a name="l00148"></a>00148 <span class="comment">/**************************************************************************/</span>
<a name="l00149"></a><a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">00149</a> idx_t <a class="code" href="coarsen_8c.html#a892d2ea16d613abc2276ad5fc6999724">Match_RM</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151   idx_t i, pi, ii, j, jj, jjinc, k, nvtxs, ncon, cnvtxs, maxidx, last_unmatched;
<a name="l00152"></a>00152   idx_t *xadj, *vwgt, *adjncy, *adjwgt, *maxvwgt;
<a name="l00153"></a>00153   idx_t *match, *cmap, *perm;
<a name="l00154"></a>00154   <span class="keywordtype">size_t</span> nunmatched=0;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   WCOREPUSH;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;MatchTmr));
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   nvtxs  = graph-&gt;nvtxs;
<a name="l00161"></a>00161   ncon   = graph-&gt;ncon;
<a name="l00162"></a>00162   xadj   = graph-&gt;xadj;
<a name="l00163"></a>00163   vwgt   = graph-&gt;vwgt;
<a name="l00164"></a>00164   adjncy = graph-&gt;adjncy;
<a name="l00165"></a>00165   adjwgt = graph-&gt;adjwgt;
<a name="l00166"></a>00166   cmap   = graph-&gt;cmap;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   maxvwgt  = ctrl-&gt;maxvwgt;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   match = iset(nvtxs, UNMATCHED, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs));
<a name="l00171"></a>00171   perm  = <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   irandArrayPermute(nvtxs, perm, nvtxs/8, 1);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keywordflow">for</span> (cnvtxs=0, last_unmatched=0, pi=0; pi&lt;nvtxs; pi++) {
<a name="l00176"></a>00176     i = perm[pi];
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (match[i] == UNMATCHED) {  <span class="comment">/* Unmatched */</span>
<a name="l00179"></a>00179       maxidx = i;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181       <span class="keywordflow">if</span> ((ncon == 1 ? vwgt[i] &lt; maxvwgt[0] : ivecle(ncon, vwgt+i*ncon, maxvwgt))) {
<a name="l00182"></a>00182         <span class="comment">/* Deal with island vertices. Find a non-island and match it with. </span>
<a name="l00183"></a>00183 <span class="comment">           The matching ignores ctrl-&gt;maxvwgt requirements */</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (xadj[i] == xadj[i+1]) {
<a name="l00185"></a>00185           last_unmatched = gk_max(pi, last_unmatched)+1;
<a name="l00186"></a>00186           <span class="keywordflow">for</span> (; last_unmatched&lt;nvtxs; last_unmatched++) {
<a name="l00187"></a>00187             j = perm[last_unmatched];
<a name="l00188"></a>00188             <span class="keywordflow">if</span> (match[j] == UNMATCHED) {
<a name="l00189"></a>00189               maxidx = j;
<a name="l00190"></a>00190               <span class="keywordflow">break</span>;
<a name="l00191"></a>00191             }
<a name="l00192"></a>00192           }
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194         <span class="keywordflow">else</span> {
<a name="l00195"></a>00195           <span class="comment">/* Find a random matching, subject to maxvwgt constraints */</span>
<a name="l00196"></a>00196           <span class="keywordflow">if</span> (ncon == 1) {
<a name="l00197"></a>00197             <span class="comment">/* single constraint version */</span>
<a name="l00198"></a>00198             <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++) {
<a name="l00199"></a>00199               k = adjncy[j];
<a name="l00200"></a>00200               <span class="keywordflow">if</span> (match[k] == UNMATCHED &amp;&amp; vwgt[i]+vwgt[k] &lt;= maxvwgt[0]) {
<a name="l00201"></a>00201                 maxidx = k;
<a name="l00202"></a>00202                 <span class="keywordflow">break</span>;
<a name="l00203"></a>00203               }
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206             <span class="comment">/* If it did not match, record for a 2-hop matching. */</span>
<a name="l00207"></a>00207             <span class="keywordflow">if</span> (maxidx == i &amp;&amp; 3*vwgt[i] &lt; maxvwgt[0]) {
<a name="l00208"></a>00208               nunmatched++;
<a name="l00209"></a>00209               maxidx = UNMATCHED;
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211           }
<a name="l00212"></a>00212           <span class="keywordflow">else</span> {
<a name="l00213"></a>00213             <span class="comment">/* multi-constraint version */</span>
<a name="l00214"></a>00214             <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++) {
<a name="l00215"></a>00215               k = adjncy[j];
<a name="l00216"></a>00216               <span class="keywordflow">if</span> (match[k] == UNMATCHED &amp;&amp; 
<a name="l00217"></a>00217                   ivecaxpylez(ncon, 1, vwgt+i*ncon, vwgt+k*ncon, maxvwgt)) {
<a name="l00218"></a>00218                 maxidx = k;
<a name="l00219"></a>00219                 <span class="keywordflow">break</span>;
<a name="l00220"></a>00220               }
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223             <span class="comment">/* If it did not match, record for a 2-hop matching. */</span>
<a name="l00224"></a>00224             <span class="keywordflow">if</span> (maxidx == i &amp;&amp; ivecaxpylez(ncon, 2, vwgt+i*ncon, vwgt+i*ncon, maxvwgt)) {
<a name="l00225"></a>00225               nunmatched++;
<a name="l00226"></a>00226               maxidx = UNMATCHED;
<a name="l00227"></a>00227             }
<a name="l00228"></a>00228           }
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230       }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232       <span class="keywordflow">if</span> (maxidx != UNMATCHED) {
<a name="l00233"></a>00233         cmap[i]  = cmap[maxidx] = cnvtxs++;
<a name="l00234"></a>00234         match[i] = maxidx;
<a name="l00235"></a>00235         match[maxidx] = i;
<a name="l00236"></a>00236       }
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="comment">//printf(&quot;nunmatched: %zu\n&quot;, nunmatched);</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="comment">/* see if a 2-hop matching is required/allowed */</span>
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (!ctrl-&gt;no2hop &amp;&amp; nunmatched &gt; UNMATCHEDFOR2HOP*nvtxs) 
<a name="l00244"></a>00244     cnvtxs = <a class="code" href="coarsen_8c.html#aead846b2c69509c914426ff087509934">Match_2Hop</a>(ctrl, graph, perm, match, cnvtxs, nunmatched);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="comment">/* match the final unmatched vertices with themselves and reorder the vertices </span>
<a name="l00248"></a>00248 <span class="comment">     of the coarse graph for memory-friendly contraction */</span>
<a name="l00249"></a>00249   <span class="keywordflow">for</span> (cnvtxs=0, i=0; i&lt;nvtxs; i++) {
<a name="l00250"></a>00250     <span class="keywordflow">if</span> (match[i] == UNMATCHED) {
<a name="l00251"></a>00251       match[i] = i;
<a name="l00252"></a>00252       cmap[i]  = cnvtxs++;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <span class="keywordflow">else</span> {
<a name="l00255"></a>00255       <span class="keywordflow">if</span> (i &lt;= match[i]) 
<a name="l00256"></a>00256         cmap[i] = cmap[match[i]] = cnvtxs++;
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;MatchTmr));
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <a class="code" href="coarsen_8c.html#aac8820421b1c25698140c1b470c50e07">CreateCoarseGraph</a>(ctrl, graph, cnvtxs, match);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   WCOREPOP;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">return</span> cnvtxs;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="comment">/**************************************************************************/</span>
<a name="l00275"></a>00275 <span class="comment">/**************************************************************************/</span>
<a name="l00276"></a><a class="code" href="coarsen_8c.html#af3ec72f3170ccdca06d8ad018d86cc58">00276</a> idx_t <a class="code" href="coarsen_8c.html#af3ec72f3170ccdca06d8ad018d86cc58">Match_SHEM</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278   idx_t i, pi, ii, j, jj, jjinc, k, nvtxs, ncon, cnvtxs, maxidx, maxwgt, 
<a name="l00279"></a>00279         last_unmatched, avgdegree;
<a name="l00280"></a>00280   idx_t *xadj, *vwgt, *adjncy, *adjwgt, *maxvwgt;
<a name="l00281"></a>00281   idx_t *match, *cmap, *degrees, *perm, *tperm;
<a name="l00282"></a>00282   <span class="keywordtype">size_t</span> nunmatched=0;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   WCOREPUSH;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;MatchTmr));
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   nvtxs  = graph-&gt;nvtxs;
<a name="l00289"></a>00289   ncon   = graph-&gt;ncon;
<a name="l00290"></a>00290   xadj   = graph-&gt;xadj;
<a name="l00291"></a>00291   vwgt   = graph-&gt;vwgt;
<a name="l00292"></a>00292   adjncy = graph-&gt;adjncy;
<a name="l00293"></a>00293   adjwgt = graph-&gt;adjwgt;
<a name="l00294"></a>00294   cmap   = graph-&gt;cmap;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   maxvwgt  = ctrl-&gt;maxvwgt;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   match   = iset(nvtxs, UNMATCHED, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs));
<a name="l00299"></a>00299   perm    = <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs);
<a name="l00300"></a>00300   tperm   = <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs);
<a name="l00301"></a>00301   degrees = <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   irandArrayPermute(nvtxs, tperm, nvtxs/8, 1);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   avgdegree = 0.7*(xadj[nvtxs]/nvtxs);
<a name="l00306"></a>00306   <span class="keywordflow">for</span> (i=0; i&lt;nvtxs; i++) 
<a name="l00307"></a>00307     degrees[i] = (xadj[i+1]-xadj[i] &gt; avgdegree ? avgdegree : xadj[i+1]-xadj[i]);
<a name="l00308"></a>00308   BucketSortKeysInc(ctrl, nvtxs, avgdegree, degrees, tperm, perm);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="keywordflow">for</span> (cnvtxs=0, last_unmatched=0, pi=0; pi&lt;nvtxs; pi++) {
<a name="l00311"></a>00311     i = perm[pi];
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (match[i] == UNMATCHED) {  <span class="comment">/* Unmatched */</span>
<a name="l00314"></a>00314       maxidx = i;
<a name="l00315"></a>00315       maxwgt = -1;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="keywordflow">if</span> ((ncon == 1 ? vwgt[i] &lt; maxvwgt[0] : ivecle(ncon, vwgt+i*ncon, maxvwgt))) {
<a name="l00318"></a>00318         <span class="comment">/* Deal with island vertices. Find a non-island and match it with. </span>
<a name="l00319"></a>00319 <span class="comment">           The matching ignores ctrl-&gt;maxvwgt requirements */</span>
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (xadj[i] == xadj[i+1]) { 
<a name="l00321"></a>00321           last_unmatched = gk_max(pi, last_unmatched)+1;
<a name="l00322"></a>00322           <span class="keywordflow">for</span> (; last_unmatched&lt;nvtxs; last_unmatched++) {
<a name="l00323"></a>00323             j = perm[last_unmatched];
<a name="l00324"></a>00324             <span class="keywordflow">if</span> (match[j] == UNMATCHED) {
<a name="l00325"></a>00325               maxidx = j;
<a name="l00326"></a>00326               <span class="keywordflow">break</span>;
<a name="l00327"></a>00327             }
<a name="l00328"></a>00328           }
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="keywordflow">else</span> {
<a name="l00331"></a>00331           <span class="comment">/* Find a heavy-edge matching, subject to maxvwgt constraints */</span>
<a name="l00332"></a>00332           <span class="keywordflow">if</span> (ncon == 1) {
<a name="l00333"></a>00333             <span class="comment">/* single constraint version */</span>
<a name="l00334"></a>00334             <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++) {
<a name="l00335"></a>00335               k = adjncy[j];
<a name="l00336"></a>00336               <span class="keywordflow">if</span> (match[k] == UNMATCHED &amp;&amp; 
<a name="l00337"></a>00337                   maxwgt &lt; adjwgt[j] &amp;&amp; vwgt[i]+vwgt[k] &lt;= maxvwgt[0]) {
<a name="l00338"></a>00338                 maxidx = k;
<a name="l00339"></a>00339                 maxwgt = adjwgt[j];
<a name="l00340"></a>00340               }
<a name="l00341"></a>00341             }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="comment">/* If it did not match, record for a 2-hop matching. */</span>
<a name="l00344"></a>00344             <span class="keywordflow">if</span> (maxidx == i &amp;&amp; 3*vwgt[i] &lt; maxvwgt[0]) {
<a name="l00345"></a>00345               nunmatched++;
<a name="l00346"></a>00346               maxidx = UNMATCHED;
<a name="l00347"></a>00347             }
<a name="l00348"></a>00348           }
<a name="l00349"></a>00349           <span class="keywordflow">else</span> {
<a name="l00350"></a>00350             <span class="comment">/* multi-constraint version */</span>
<a name="l00351"></a>00351             <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++) {
<a name="l00352"></a>00352               k = adjncy[j];
<a name="l00353"></a>00353               <span class="keywordflow">if</span> (match[k] == UNMATCHED &amp;&amp; 
<a name="l00354"></a>00354                   ivecaxpylez(ncon, 1, vwgt+i*ncon, vwgt+k*ncon, maxvwgt) &amp;&amp;
<a name="l00355"></a>00355                   (maxwgt &lt; adjwgt[j] || 
<a name="l00356"></a>00356                    (maxwgt == adjwgt[j] &amp;&amp; 
<a name="l00357"></a>00357                     BetterVBalance(ncon, graph-&gt;invtvwgt, vwgt+i*ncon, 
<a name="l00358"></a>00358                         vwgt+maxidx*ncon, vwgt+k*ncon)))) {
<a name="l00359"></a>00359                 maxidx = k;
<a name="l00360"></a>00360                 maxwgt = adjwgt[j];
<a name="l00361"></a>00361               }
<a name="l00362"></a>00362             }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364             <span class="comment">/* If it did not match, record for a 2-hop matching. */</span>
<a name="l00365"></a>00365             <span class="keywordflow">if</span> (maxidx == i &amp;&amp; ivecaxpylez(ncon, 2, vwgt+i*ncon, vwgt+i*ncon, maxvwgt)) {
<a name="l00366"></a>00366               nunmatched++;
<a name="l00367"></a>00367               maxidx = UNMATCHED;
<a name="l00368"></a>00368             }
<a name="l00369"></a>00369           }
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371       }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373       <span class="keywordflow">if</span> (maxidx != UNMATCHED) {
<a name="l00374"></a>00374         cmap[i]  = cmap[maxidx] = cnvtxs++;
<a name="l00375"></a>00375         match[i] = maxidx;
<a name="l00376"></a>00376         match[maxidx] = i;
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379   }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="comment">//printf(&quot;nunmatched: %zu\n&quot;, nunmatched);</span>
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="comment">/* see if a 2-hop matching is required/allowed */</span>
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (!ctrl-&gt;no2hop &amp;&amp; nunmatched &gt; UNMATCHEDFOR2HOP*nvtxs) 
<a name="l00385"></a>00385     cnvtxs = <a class="code" href="coarsen_8c.html#aead846b2c69509c914426ff087509934">Match_2Hop</a>(ctrl, graph, perm, match, cnvtxs, nunmatched);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   <span class="comment">/* match the final unmatched vertices with themselves and reorder the vertices </span>
<a name="l00389"></a>00389 <span class="comment">     of the coarse graph for memory-friendly contraction */</span>
<a name="l00390"></a>00390   <span class="keywordflow">for</span> (cnvtxs=0, i=0; i&lt;nvtxs; i++) {
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (match[i] == UNMATCHED) {
<a name="l00392"></a>00392       match[i] = i;
<a name="l00393"></a>00393       cmap[i] = cnvtxs++;
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395     <span class="keywordflow">else</span> {
<a name="l00396"></a>00396       <span class="keywordflow">if</span> (i &lt;= match[i]) 
<a name="l00397"></a>00397         cmap[i] = cmap[match[i]] = cnvtxs++;
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;MatchTmr));
<a name="l00402"></a>00402 
<a name="l00403"></a>00403   <a class="code" href="coarsen_8c.html#aac8820421b1c25698140c1b470c50e07">CreateCoarseGraph</a>(ctrl, graph, cnvtxs, match);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   WCOREPOP;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   <span class="keywordflow">return</span> cnvtxs;
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">/*************************************************************************/</span>
<a name="l00414"></a>00414 <span class="comment">/**************************************************************************/</span>
<a name="l00415"></a><a class="code" href="coarsen_8c.html#aead846b2c69509c914426ff087509934">00415</a> idx_t <a class="code" href="coarsen_8c.html#aead846b2c69509c914426ff087509934">Match_2Hop</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t *perm, idx_t *match, 
<a name="l00416"></a>00416           idx_t cnvtxs, <span class="keywordtype">size_t</span> nunmatched)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   cnvtxs = <a class="code" href="coarsen_8c.html#a838a4013e3b5cc5278ecc7a8757ce0ef">Match_2HopAny</a>(ctrl, graph, perm, match, cnvtxs, &amp;nunmatched, 2);
<a name="l00420"></a>00420   cnvtxs = <a class="code" href="coarsen_8c.html#aa56d53cace160be27fb1750dcaffbc04">Match_2HopAll</a>(ctrl, graph, perm, match, cnvtxs, &amp;nunmatched, 64);
<a name="l00421"></a>00421   <span class="keywordflow">if</span> (nunmatched &gt; 1.5*UNMATCHEDFOR2HOP*graph-&gt;nvtxs) 
<a name="l00422"></a>00422     cnvtxs = <a class="code" href="coarsen_8c.html#a838a4013e3b5cc5278ecc7a8757ce0ef">Match_2HopAny</a>(ctrl, graph, perm, match, cnvtxs, &amp;nunmatched, 3);
<a name="l00423"></a>00423   <span class="keywordflow">if</span> (nunmatched &gt; 2.0*UNMATCHEDFOR2HOP*graph-&gt;nvtxs) 
<a name="l00424"></a>00424     cnvtxs = <a class="code" href="coarsen_8c.html#a838a4013e3b5cc5278ecc7a8757ce0ef">Match_2HopAny</a>(ctrl, graph, perm, match, cnvtxs, &amp;nunmatched, graph-&gt;nvtxs);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keywordflow">return</span> cnvtxs;
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">/*************************************************************************/</span>
<a name="l00436"></a>00436 <span class="comment">/**************************************************************************/</span>
<a name="l00437"></a><a class="code" href="coarsen_8c.html#a838a4013e3b5cc5278ecc7a8757ce0ef">00437</a> idx_t <a class="code" href="coarsen_8c.html#a838a4013e3b5cc5278ecc7a8757ce0ef">Match_2HopAny</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t *perm, idx_t *match, 
<a name="l00438"></a>00438           idx_t cnvtxs, <span class="keywordtype">size_t</span> *r_nunmatched, <span class="keywordtype">size_t</span> maxdegree)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440   idx_t i, pi, ii, j, jj, k, nvtxs;
<a name="l00441"></a>00441   idx_t *xadj, *adjncy, *colptr, *rowind;
<a name="l00442"></a>00442   idx_t *cmap;
<a name="l00443"></a>00443   <span class="keywordtype">size_t</span> nunmatched;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;Aux3Tmr));
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   nvtxs  = graph-&gt;nvtxs;
<a name="l00448"></a>00448   xadj   = graph-&gt;xadj;
<a name="l00449"></a>00449   adjncy = graph-&gt;adjncy;
<a name="l00450"></a>00450   cmap   = graph-&gt;cmap;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   nunmatched = *r_nunmatched;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="comment">/*IFSET(ctrl-&gt;dbglvl, METIS_DBG_COARSEN, printf(&quot;IN: nunmatched: %zu\t&quot;, * nunmatched)); */</span>
<a name="l00455"></a>00455 
<a name="l00456"></a>00456   <span class="comment">/* create the inverted index */</span>
<a name="l00457"></a>00457   WCOREPUSH;
<a name="l00458"></a>00458   colptr = iset(nvtxs, 0, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs+1));
<a name="l00459"></a>00459   <span class="keywordflow">for</span> (i=0; i&lt;nvtxs; i++) {
<a name="l00460"></a>00460     <span class="keywordflow">if</span> (match[i] == UNMATCHED &amp;&amp; xadj[i+1]-xadj[i] &lt; maxdegree) {
<a name="l00461"></a>00461       <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++)
<a name="l00462"></a>00462         colptr[adjncy[j]]++;
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465   MAKECSR(i, nvtxs, colptr);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   rowind = <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, colptr[nvtxs]);
<a name="l00468"></a>00468   <span class="keywordflow">for</span> (pi=0; pi&lt;nvtxs; pi++) {
<a name="l00469"></a>00469     i = perm[pi];
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (match[i] == UNMATCHED &amp;&amp; xadj[i+1]-xadj[i] &lt; maxdegree) {
<a name="l00471"></a>00471       <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++)
<a name="l00472"></a>00472         rowind[colptr[adjncy[j]]++] = i;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475   SHIFTCSR(i, nvtxs, colptr);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   <span class="comment">/* compute matchings by going down the inverted index */</span>
<a name="l00478"></a>00478   <span class="keywordflow">for</span> (pi=0; pi&lt;nvtxs; pi++) {
<a name="l00479"></a>00479     i = perm[pi];
<a name="l00480"></a>00480     <span class="keywordflow">if</span> (colptr[i+1]-colptr[i] &lt; 2)
<a name="l00481"></a>00481       <span class="keywordflow">continue</span>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="keywordflow">for</span> (jj=colptr[i+1], j=colptr[i]; j&lt;jj; j++) {
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (match[rowind[j]] == UNMATCHED) {
<a name="l00485"></a>00485         <span class="keywordflow">for</span> (jj--; jj&gt;j; jj--) {
<a name="l00486"></a>00486           <span class="keywordflow">if</span> (match[rowind[jj]] == UNMATCHED) {
<a name="l00487"></a>00487             cmap[rowind[j]] = cmap[rowind[jj]] = cnvtxs++;
<a name="l00488"></a>00488             match[rowind[j]]  = rowind[jj];
<a name="l00489"></a>00489             match[rowind[jj]] = rowind[j];
<a name="l00490"></a>00490             nunmatched -= 2;
<a name="l00491"></a>00491             <span class="keywordflow">break</span>;
<a name="l00492"></a>00492           }
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496   }
<a name="l00497"></a>00497   WCOREPOP;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="comment">/* IFSET(ctrl-&gt;dbglvl, METIS_DBG_COARSEN, printf(&quot;OUT: nunmatched: %zu\n&quot;, nunmatched)); */</span>
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;Aux3Tmr));
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   *r_nunmatched = nunmatched;
<a name="l00504"></a>00504   <span class="keywordflow">return</span> cnvtxs;
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="comment">/*************************************************************************/</span>
<a name="l00515"></a>00515 <span class="comment">/**************************************************************************/</span>
<a name="l00516"></a><a class="code" href="coarsen_8c.html#aa56d53cace160be27fb1750dcaffbc04">00516</a> idx_t <a class="code" href="coarsen_8c.html#aa56d53cace160be27fb1750dcaffbc04">Match_2HopAll</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t *perm, idx_t *match, 
<a name="l00517"></a>00517           idx_t cnvtxs, <span class="keywordtype">size_t</span> *r_nunmatched, <span class="keywordtype">size_t</span> maxdegree)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519   idx_t i, pi, pk, ii, j, jj, k, nvtxs, mask, idegree;
<a name="l00520"></a>00520   idx_t *xadj, *adjncy;
<a name="l00521"></a>00521   idx_t *cmap, *mark;
<a name="l00522"></a>00522   ikv_t *keys;
<a name="l00523"></a>00523   <span class="keywordtype">size_t</span> nunmatched, ncand;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;Aux3Tmr));
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   nvtxs  = graph-&gt;nvtxs;
<a name="l00528"></a>00528   xadj   = graph-&gt;xadj;
<a name="l00529"></a>00529   adjncy = graph-&gt;adjncy;
<a name="l00530"></a>00530   cmap   = graph-&gt;cmap;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   nunmatched = *r_nunmatched;
<a name="l00533"></a>00533   mask = IDX_MAX/maxdegree;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <span class="comment">/*IFSET(ctrl-&gt;dbglvl, METIS_DBG_COARSEN, printf(&quot;IN: nunmatched: %zu\t&quot;, nunmatched)); */</span>
<a name="l00536"></a>00536 
<a name="l00537"></a>00537   WCOREPUSH;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="comment">/* collapse vertices with identical adjancency lists */</span>
<a name="l00540"></a>00540   keys = <a class="code" href="wspace_8c.html#a84ec1bdf52bc3f92ae3f2e43c42545ca">ikvwspacemalloc</a>(ctrl, nunmatched);
<a name="l00541"></a>00541   <span class="keywordflow">for</span> (ncand=0, pi=0; pi&lt;nvtxs; pi++) {
<a name="l00542"></a>00542     i = perm[pi];
<a name="l00543"></a>00543     idegree = xadj[i+1]-xadj[i];
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (match[i] == UNMATCHED &amp;&amp; idegree &gt; 1 &amp;&amp; idegree &lt; maxdegree) {
<a name="l00545"></a>00545       <span class="keywordflow">for</span> (k=0, j=xadj[i]; j&lt;xadj[i+1]; j++) 
<a name="l00546"></a>00546         k += adjncy[j]%mask;
<a name="l00547"></a>00547       keys[ncand].val = i;
<a name="l00548"></a>00548       keys[ncand].key = (k%mask)*maxdegree + idegree;
<a name="l00549"></a>00549       ncand++;
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551   }
<a name="l00552"></a>00552   ikvsorti(ncand, keys);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   mark = iset(nvtxs, 0, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, nvtxs));
<a name="l00555"></a>00555   <span class="keywordflow">for</span> (pi=0; pi&lt;ncand; pi++) {
<a name="l00556"></a>00556     i = keys[pi].val;
<a name="l00557"></a>00557     <span class="keywordflow">if</span> (match[i] != UNMATCHED)
<a name="l00558"></a>00558       <span class="keywordflow">continue</span>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="keywordflow">for</span> (j=xadj[i]; j&lt;xadj[i+1]; j++)
<a name="l00561"></a>00561       mark[adjncy[j]] = i;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="keywordflow">for</span> (pk=pi+1; pk&lt;ncand; pk++) {
<a name="l00564"></a>00564       k = keys[pk].val;
<a name="l00565"></a>00565       <span class="keywordflow">if</span> (match[k] != UNMATCHED)
<a name="l00566"></a>00566         <span class="keywordflow">continue</span>;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       <span class="keywordflow">if</span> (keys[pi].key != keys[pk].key)
<a name="l00569"></a>00569         <span class="keywordflow">break</span>;
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (xadj[i+1]-xadj[i] != xadj[k+1]-xadj[k])
<a name="l00571"></a>00571         <span class="keywordflow">break</span>;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573       <span class="keywordflow">for</span> (jj=xadj[k]; jj&lt;xadj[k+1]; jj++) {
<a name="l00574"></a>00574         <span class="keywordflow">if</span> (mark[adjncy[jj]] != i)
<a name="l00575"></a>00575           <span class="keywordflow">break</span>;
<a name="l00576"></a>00576       }
<a name="l00577"></a>00577       <span class="keywordflow">if</span> (jj == xadj[k+1]) {
<a name="l00578"></a>00578         cmap[i] = cmap[k] = cnvtxs++;
<a name="l00579"></a>00579         match[i] = k;
<a name="l00580"></a>00580         match[k] = i;
<a name="l00581"></a>00581         nunmatched -= 2;
<a name="l00582"></a>00582         <span class="keywordflow">break</span>;
<a name="l00583"></a>00583       }
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585   }
<a name="l00586"></a>00586   WCOREPOP;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <span class="comment">/*IFSET(ctrl-&gt;dbglvl, METIS_DBG_COARSEN, printf(&quot;OUT: ncand: %zu, nunmatched: %zu\n&quot;, ncand, nunmatched)); */</span>
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;Aux3Tmr));
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   *r_nunmatched = nunmatched;
<a name="l00593"></a>00593   <span class="keywordflow">return</span> cnvtxs;
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 <span class="comment">/*************************************************************************/</span>
<a name="l00600"></a>00600 <span class="comment">/*************************************************************************/</span>
<a name="l00601"></a><a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">00601</a> <span class="keywordtype">void</span> <a class="code" href="coarsen_8c.html#aac3e480e7e3bd02bfdf001d858a93562">PrintCGraphStats</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603   idx_t i;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605   printf(<span class="stringliteral">&quot;%10&quot;</span>PRIDX<span class="stringliteral">&quot; %10&quot;</span>PRIDX<span class="stringliteral">&quot; %10&quot;</span>PRIDX<span class="stringliteral">&quot; [%&quot;</span>PRIDX<span class="stringliteral">&quot;] [&quot;</span>, 
<a name="l00606"></a>00606       graph-&gt;nvtxs, graph-&gt;nedges, isum(graph-&gt;nedges, graph-&gt;adjwgt, 1), ctrl-&gt;CoarsenTo);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608   <span class="keywordflow">for</span> (i=0; i&lt;graph-&gt;ncon; i++)
<a name="l00609"></a>00609     printf(<span class="stringliteral">&quot; %8&quot;</span>PRIDX<span class="stringliteral">&quot;:%8&quot;</span>PRIDX, ctrl-&gt;maxvwgt[i], graph-&gt;tvwgt[i]);
<a name="l00610"></a>00610   printf(<span class="stringliteral">&quot; ]\n&quot;</span>);
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="comment">/*************************************************************************/</span>
<a name="l00620"></a>00620 <span class="comment">/*************************************************************************/</span>
<a name="l00621"></a><a class="code" href="coarsen_8c.html#aac8820421b1c25698140c1b470c50e07">00621</a> <span class="keywordtype">void</span> <a class="code" href="coarsen_8c.html#aac8820421b1c25698140c1b470c50e07">CreateCoarseGraph</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t cnvtxs, 
<a name="l00622"></a>00622          idx_t *match)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624   idx_t j, jj, k, kk, l, m, istart, iend, nvtxs, nedges, ncon, cnedges, 
<a name="l00625"></a>00625         v, u, mask, dovsize;
<a name="l00626"></a>00626   idx_t *xadj, *vwgt, *vsize, *adjncy, *adjwgt;
<a name="l00627"></a>00627   idx_t *cmap, *htable;
<a name="l00628"></a>00628   idx_t *cxadj, *cvwgt, *cvsize, *cadjncy, *cadjwgt;
<a name="l00629"></a>00629   <a class="code" href="structgraph__t.html">graph_t</a> *cgraph;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   dovsize = (ctrl-&gt;objtype == METIS_OBJTYPE_VOL ? 1 : 0);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">/* Check if the mask-version of the code is a good choice */</span>
<a name="l00634"></a>00634   mask = HTLENGTH;
<a name="l00635"></a>00635   <span class="keywordflow">if</span> (cnvtxs &lt; 2*mask || graph-&gt;nedges/graph-&gt;nvtxs &gt; mask/20) { 
<a name="l00636"></a>00636     <a class="code" href="coarsen_8c.html#a70dc59d4c7190507e7ad9a4cc0d80707">CreateCoarseGraphNoMask</a>(ctrl, graph, cnvtxs, match);
<a name="l00637"></a>00637     <span class="keywordflow">return</span>;
<a name="l00638"></a>00638   }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   nvtxs = graph-&gt;nvtxs;
<a name="l00641"></a>00641   xadj  = graph-&gt;xadj;
<a name="l00642"></a>00642   <span class="keywordflow">for</span> (v=0; v&lt;nvtxs; v++) {
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (xadj[v+1]-xadj[v] &gt; (mask&gt;&gt;3)) {
<a name="l00644"></a>00644       <a class="code" href="coarsen_8c.html#a70dc59d4c7190507e7ad9a4cc0d80707">CreateCoarseGraphNoMask</a>(ctrl, graph, cnvtxs, match);
<a name="l00645"></a>00645       <span class="keywordflow">return</span>;
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647   }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   WCOREPUSH;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;ContractTmr));
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   ncon    = graph-&gt;ncon;
<a name="l00655"></a>00655   vwgt    = graph-&gt;vwgt;
<a name="l00656"></a>00656   vsize   = graph-&gt;vsize;
<a name="l00657"></a>00657   adjncy  = graph-&gt;adjncy;
<a name="l00658"></a>00658   adjwgt  = graph-&gt;adjwgt;
<a name="l00659"></a>00659   cmap    = graph-&gt;cmap;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <span class="comment">/* Initialize the coarser graph */</span>
<a name="l00662"></a>00662   cgraph   = <a class="code" href="coarsen_8c.html#a113522304bf628b09d0b69b4db05050e">SetupCoarseGraph</a>(graph, cnvtxs, dovsize);
<a name="l00663"></a>00663   cxadj    = cgraph-&gt;xadj;
<a name="l00664"></a>00664   cvwgt    = cgraph-&gt;vwgt;
<a name="l00665"></a>00665   cvsize   = cgraph-&gt;vsize;
<a name="l00666"></a>00666   cadjncy  = cgraph-&gt;adjncy;
<a name="l00667"></a>00667   cadjwgt  = cgraph-&gt;adjwgt;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   htable = iset(gk_min(cnvtxs+1, mask+1), -1, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, mask+1)); 
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   cxadj[0] = cnvtxs = cnedges = 0;
<a name="l00672"></a>00672   <span class="keywordflow">for</span> (v=0; v&lt;nvtxs; v++) {
<a name="l00673"></a>00673     <span class="keywordflow">if</span> ((u = match[v]) &lt; v)
<a name="l00674"></a>00674       <span class="keywordflow">continue</span>;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     ASSERT(cmap[v] == cnvtxs);
<a name="l00677"></a>00677     ASSERT(cmap[match[v]] == cnvtxs);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="keywordflow">if</span> (ncon == 1)
<a name="l00680"></a>00680       cvwgt[cnvtxs] = vwgt[v];
<a name="l00681"></a>00681     <span class="keywordflow">else</span>
<a name="l00682"></a>00682       icopy(ncon, vwgt+v*ncon, cvwgt+cnvtxs*ncon);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (dovsize)
<a name="l00685"></a>00685       cvsize[cnvtxs] = vsize[v];
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     nedges = 0;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     istart = xadj[v];
<a name="l00690"></a>00690     iend   = xadj[v+1];
<a name="l00691"></a>00691     <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l00692"></a>00692       k  = cmap[adjncy[j]];
<a name="l00693"></a>00693       kk = k&amp;mask;
<a name="l00694"></a>00694       <span class="keywordflow">if</span> ((m = htable[kk]) == -1) {
<a name="l00695"></a>00695         cadjncy[nedges] = k;
<a name="l00696"></a>00696         cadjwgt[nedges] = adjwgt[j];
<a name="l00697"></a>00697         htable[kk] = nedges++;
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cadjncy[m] == k) {
<a name="l00700"></a>00700         cadjwgt[m] += adjwgt[j];
<a name="l00701"></a>00701       }
<a name="l00702"></a>00702       <span class="keywordflow">else</span> {
<a name="l00703"></a>00703         <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l00704"></a>00704           <span class="keywordflow">if</span> (cadjncy[jj] == k) {
<a name="l00705"></a>00705             cadjwgt[jj] += adjwgt[j];
<a name="l00706"></a>00706             <span class="keywordflow">break</span>;
<a name="l00707"></a>00707           }
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         <span class="keywordflow">if</span> (jj == nedges) {
<a name="l00710"></a>00710           cadjncy[nedges]   = k;
<a name="l00711"></a>00711           cadjwgt[nedges++] = adjwgt[j];
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713       }
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">if</span> (v != u) { 
<a name="l00717"></a>00717       <span class="keywordflow">if</span> (ncon == 1)
<a name="l00718"></a>00718         cvwgt[cnvtxs] += vwgt[u];
<a name="l00719"></a>00719       <span class="keywordflow">else</span>
<a name="l00720"></a>00720         iaxpy(ncon, 1, vwgt+u*ncon, 1, cvwgt+cnvtxs*ncon, 1);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722       <span class="keywordflow">if</span> (dovsize)
<a name="l00723"></a>00723         cvsize[cnvtxs] += vsize[u];
<a name="l00724"></a>00724 
<a name="l00725"></a>00725       istart = xadj[u];
<a name="l00726"></a>00726       iend   = xadj[u+1];
<a name="l00727"></a>00727       <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l00728"></a>00728         k  = cmap[adjncy[j]];
<a name="l00729"></a>00729         kk = k&amp;mask;
<a name="l00730"></a>00730         <span class="keywordflow">if</span> ((m = htable[kk]) == -1) {
<a name="l00731"></a>00731           cadjncy[nedges] = k;
<a name="l00732"></a>00732           cadjwgt[nedges] = adjwgt[j];
<a name="l00733"></a>00733           htable[kk]      = nedges++;
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cadjncy[m] == k) {
<a name="l00736"></a>00736           cadjwgt[m] += adjwgt[j];
<a name="l00737"></a>00737         }
<a name="l00738"></a>00738         <span class="keywordflow">else</span> {
<a name="l00739"></a>00739           <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l00740"></a>00740             <span class="keywordflow">if</span> (cadjncy[jj] == k) {
<a name="l00741"></a>00741               cadjwgt[jj] += adjwgt[j];
<a name="l00742"></a>00742               <span class="keywordflow">break</span>;
<a name="l00743"></a>00743             }
<a name="l00744"></a>00744           }
<a name="l00745"></a>00745           <span class="keywordflow">if</span> (jj == nedges) {
<a name="l00746"></a>00746             cadjncy[nedges]   = k;
<a name="l00747"></a>00747             cadjwgt[nedges++] = adjwgt[j];
<a name="l00748"></a>00748           }
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750       }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752       <span class="comment">/* Remove the contracted adjacency weight */</span>
<a name="l00753"></a>00753       jj = htable[cnvtxs&amp;mask];
<a name="l00754"></a>00754       <span class="keywordflow">if</span> (jj &gt;= 0 &amp;&amp; cadjncy[jj] != cnvtxs) {
<a name="l00755"></a>00755         <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l00756"></a>00756           <span class="keywordflow">if</span> (cadjncy[jj] == cnvtxs) 
<a name="l00757"></a>00757             <span class="keywordflow">break</span>;
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760       <span class="comment">/* This 2nd check is needed for non-adjacent matchings */</span>
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (jj &gt;= 0 &amp;&amp; jj &lt; nedges &amp;&amp; cadjncy[jj] == cnvtxs) { 
<a name="l00762"></a>00762         cadjncy[jj] = cadjncy[--nedges];
<a name="l00763"></a>00763         cadjwgt[jj] = cadjwgt[nedges];
<a name="l00764"></a>00764       }
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     <span class="comment">/* Zero out the htable */</span>
<a name="l00768"></a>00768     <span class="keywordflow">for</span> (j=0; j&lt;nedges; j++)
<a name="l00769"></a>00769       htable[cadjncy[j]&amp;mask] = -1;  
<a name="l00770"></a>00770     htable[cnvtxs&amp;mask] = -1;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     cnedges         += nedges;
<a name="l00773"></a>00773     cxadj[++cnvtxs]  = cnedges;
<a name="l00774"></a>00774     cadjncy         += nedges;
<a name="l00775"></a>00775     cadjwgt         += nedges;
<a name="l00776"></a>00776   }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778   cgraph-&gt;nedges = cnedges;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <span class="keywordflow">for</span> (j=0; j&lt;ncon; j++) {
<a name="l00781"></a>00781     cgraph-&gt;tvwgt[j]    = isum(cgraph-&gt;nvtxs, cgraph-&gt;vwgt+j, ncon);
<a name="l00782"></a>00782     cgraph-&gt;invtvwgt[j] = 1.0/(cgraph-&gt;tvwgt[j] &gt; 0 ? cgraph-&gt;tvwgt[j] : 1);
<a name="l00783"></a>00783   }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 
<a name="l00786"></a>00786   <a class="code" href="coarsen_8c.html#ab69ab96ec78174da232dff05e9c79d2f">ReAdjustMemory</a>(ctrl, graph, cgraph);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;ContractTmr));
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   WCOREPOP;
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">/*************************************************************************/</span>
<a name="l00799"></a>00799 <span class="comment">/*************************************************************************/</span>
<a name="l00800"></a><a class="code" href="coarsen_8c.html#a70dc59d4c7190507e7ad9a4cc0d80707">00800</a> <span class="keywordtype">void</span> <a class="code" href="coarsen_8c.html#a70dc59d4c7190507e7ad9a4cc0d80707">CreateCoarseGraphNoMask</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t cnvtxs, 
<a name="l00801"></a>00801          idx_t *match)
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803   idx_t j, k, m, istart, iend, nvtxs, nedges, ncon, cnedges, v, u, dovsize;
<a name="l00804"></a>00804   idx_t *xadj, *vwgt, *vsize, *adjncy, *adjwgt;
<a name="l00805"></a>00805   idx_t *cmap, *htable;
<a name="l00806"></a>00806   idx_t *cxadj, *cvwgt, *cvsize, *cadjncy, *cadjwgt;
<a name="l00807"></a>00807   <a class="code" href="structgraph__t.html">graph_t</a> *cgraph;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   WCOREPUSH;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811   dovsize = (ctrl-&gt;objtype == METIS_OBJTYPE_VOL ? 1 : 0);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;ContractTmr));
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   nvtxs   = graph-&gt;nvtxs;
<a name="l00816"></a>00816   ncon    = graph-&gt;ncon;
<a name="l00817"></a>00817   xadj    = graph-&gt;xadj;
<a name="l00818"></a>00818   vwgt    = graph-&gt;vwgt;
<a name="l00819"></a>00819   vsize   = graph-&gt;vsize;
<a name="l00820"></a>00820   adjncy  = graph-&gt;adjncy;
<a name="l00821"></a>00821   adjwgt  = graph-&gt;adjwgt;
<a name="l00822"></a>00822   cmap    = graph-&gt;cmap;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 
<a name="l00825"></a>00825   <span class="comment">/* Initialize the coarser graph */</span>
<a name="l00826"></a>00826   cgraph = <a class="code" href="coarsen_8c.html#a113522304bf628b09d0b69b4db05050e">SetupCoarseGraph</a>(graph, cnvtxs, dovsize);
<a name="l00827"></a>00827   cxadj    = cgraph-&gt;xadj;
<a name="l00828"></a>00828   cvwgt    = cgraph-&gt;vwgt;
<a name="l00829"></a>00829   cvsize   = cgraph-&gt;vsize;
<a name="l00830"></a>00830   cadjncy  = cgraph-&gt;adjncy;
<a name="l00831"></a>00831   cadjwgt  = cgraph-&gt;adjwgt;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833   htable = iset(cnvtxs, -1, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, cnvtxs));
<a name="l00834"></a>00834 
<a name="l00835"></a>00835   cxadj[0] = cnvtxs = cnedges = 0;
<a name="l00836"></a>00836   <span class="keywordflow">for</span> (v=0; v&lt;nvtxs; v++) {
<a name="l00837"></a>00837     <span class="keywordflow">if</span> ((u = match[v]) &lt; v)
<a name="l00838"></a>00838       <span class="keywordflow">continue</span>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     ASSERT(cmap[v] == cnvtxs);
<a name="l00841"></a>00841     ASSERT(cmap[match[v]] == cnvtxs);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="keywordflow">if</span> (ncon == 1)
<a name="l00844"></a>00844       cvwgt[cnvtxs] = vwgt[v];
<a name="l00845"></a>00845     <span class="keywordflow">else</span>
<a name="l00846"></a>00846       icopy(ncon, vwgt+v*ncon, cvwgt+cnvtxs*ncon);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     <span class="keywordflow">if</span> (dovsize)
<a name="l00849"></a>00849       cvsize[cnvtxs] = vsize[v];
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     nedges = 0;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     istart = xadj[v];
<a name="l00854"></a>00854     iend   = xadj[v+1];
<a name="l00855"></a>00855     <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l00856"></a>00856       k = cmap[adjncy[j]];
<a name="l00857"></a>00857       <span class="keywordflow">if</span> ((m = htable[k]) == -1) {
<a name="l00858"></a>00858         cadjncy[nedges] = k;
<a name="l00859"></a>00859         cadjwgt[nedges] = adjwgt[j];
<a name="l00860"></a>00860         htable[k] = nedges++;
<a name="l00861"></a>00861       }
<a name="l00862"></a>00862       <span class="keywordflow">else</span> {
<a name="l00863"></a>00863         cadjwgt[m] += adjwgt[j];
<a name="l00864"></a>00864       }
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (v != u) { 
<a name="l00868"></a>00868       <span class="keywordflow">if</span> (ncon == 1)
<a name="l00869"></a>00869         cvwgt[cnvtxs] += vwgt[u];
<a name="l00870"></a>00870       <span class="keywordflow">else</span>
<a name="l00871"></a>00871         iaxpy(ncon, 1, vwgt+u*ncon, 1, cvwgt+cnvtxs*ncon, 1);
<a name="l00872"></a>00872 
<a name="l00873"></a>00873       <span class="keywordflow">if</span> (dovsize)
<a name="l00874"></a>00874         cvsize[cnvtxs] += vsize[u];
<a name="l00875"></a>00875 
<a name="l00876"></a>00876       istart = xadj[u];
<a name="l00877"></a>00877       iend   = xadj[u+1];
<a name="l00878"></a>00878       <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l00879"></a>00879         k = cmap[adjncy[j]];
<a name="l00880"></a>00880         <span class="keywordflow">if</span> ((m = htable[k]) == -1) {
<a name="l00881"></a>00881           cadjncy[nedges] = k;
<a name="l00882"></a>00882           cadjwgt[nedges] = adjwgt[j];
<a name="l00883"></a>00883           htable[k] = nedges++;
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885         <span class="keywordflow">else</span> {
<a name="l00886"></a>00886           cadjwgt[m] += adjwgt[j];
<a name="l00887"></a>00887         }
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890       <span class="comment">/* Remove the contracted adjacency weight */</span>
<a name="l00891"></a>00891       <span class="keywordflow">if</span> ((j = htable[cnvtxs]) != -1) {
<a name="l00892"></a>00892         ASSERT(cadjncy[j] == cnvtxs);
<a name="l00893"></a>00893         cadjncy[j]        = cadjncy[--nedges];
<a name="l00894"></a>00894         cadjwgt[j]        = cadjwgt[nedges];
<a name="l00895"></a>00895         htable[cnvtxs] = -1;
<a name="l00896"></a>00896       }
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="comment">/* Zero out the htable */</span>
<a name="l00900"></a>00900     <span class="keywordflow">for</span> (j=0; j&lt;nedges; j++)
<a name="l00901"></a>00901       htable[cadjncy[j]] = -1;  
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     cnedges         += nedges;
<a name="l00904"></a>00904     cxadj[++cnvtxs]  = cnedges;
<a name="l00905"></a>00905     cadjncy         += nedges;
<a name="l00906"></a>00906     cadjwgt         += nedges;
<a name="l00907"></a>00907   }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   cgraph-&gt;nedges = cnedges;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911   <span class="keywordflow">for</span> (j=0; j&lt;ncon; j++) {
<a name="l00912"></a>00912     cgraph-&gt;tvwgt[j]    = isum(cgraph-&gt;nvtxs, cgraph-&gt;vwgt+j, ncon);
<a name="l00913"></a>00913     cgraph-&gt;invtvwgt[j] = 1.0/(cgraph-&gt;tvwgt[j] &gt; 0 ? cgraph-&gt;tvwgt[j] : 1);
<a name="l00914"></a>00914   }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916   <a class="code" href="coarsen_8c.html#ab69ab96ec78174da232dff05e9c79d2f">ReAdjustMemory</a>(ctrl, graph, cgraph);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;ContractTmr));
<a name="l00919"></a>00919 
<a name="l00920"></a>00920   WCOREPOP;
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="comment">/*************************************************************************/</span>
<a name="l00931"></a>00931 <span class="comment">/*************************************************************************/</span>
<a name="l00932"></a><a class="code" href="coarsen_8c.html#a0aba484ba693edd6d56426d04bd7fd4b">00932</a> <span class="keywordtype">void</span> <a class="code" href="coarsen_8c.html#a0aba484ba693edd6d56426d04bd7fd4b">CreateCoarseGraphPerm</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t cnvtxs, 
<a name="l00933"></a>00933          idx_t *match, idx_t *perm)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935   idx_t i, j, jj, k, kk, l, m, istart, iend, nvtxs, nedges, ncon, cnedges, 
<a name="l00936"></a>00936         v, u, mask, dovsize;
<a name="l00937"></a>00937   idx_t *xadj, *vwgt, *vsize, *adjncy, *adjwgt;
<a name="l00938"></a>00938   idx_t *cmap, *htable;
<a name="l00939"></a>00939   idx_t *cxadj, *cvwgt, *cvsize, *cadjncy, *cadjwgt;
<a name="l00940"></a>00940   <a class="code" href="structgraph__t.html">graph_t</a> *cgraph;
<a name="l00941"></a>00941 
<a name="l00942"></a>00942   WCOREPUSH;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_startcputimer(ctrl-&gt;ContractTmr));
<a name="l00945"></a>00945 
<a name="l00946"></a>00946   dovsize = (ctrl-&gt;objtype == METIS_OBJTYPE_VOL ? 1 : 0);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948   mask = HTLENGTH;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950   nvtxs   = graph-&gt;nvtxs;
<a name="l00951"></a>00951   ncon    = graph-&gt;ncon;
<a name="l00952"></a>00952   xadj    = graph-&gt;xadj;
<a name="l00953"></a>00953   vwgt    = graph-&gt;vwgt;
<a name="l00954"></a>00954   vsize   = graph-&gt;vsize;
<a name="l00955"></a>00955   adjncy  = graph-&gt;adjncy;
<a name="l00956"></a>00956   adjwgt  = graph-&gt;adjwgt;
<a name="l00957"></a>00957   cmap    = graph-&gt;cmap;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   <span class="comment">/* Initialize the coarser graph */</span>
<a name="l00960"></a>00960   cgraph   = <a class="code" href="coarsen_8c.html#a113522304bf628b09d0b69b4db05050e">SetupCoarseGraph</a>(graph, cnvtxs, dovsize);
<a name="l00961"></a>00961   cxadj    = cgraph-&gt;xadj;
<a name="l00962"></a>00962   cvwgt    = cgraph-&gt;vwgt;
<a name="l00963"></a>00963   cvsize   = cgraph-&gt;vsize;
<a name="l00964"></a>00964   cadjncy  = cgraph-&gt;adjncy;
<a name="l00965"></a>00965   cadjwgt  = cgraph-&gt;adjwgt;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967   htable = iset(mask+1, -1, <a class="code" href="wspace_8c.html#a24ba749ade92aef079e88d233317c068">iwspacemalloc</a>(ctrl, mask+1)); 
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   cxadj[0] = cnvtxs = cnedges = 0;
<a name="l00970"></a>00970   <span class="keywordflow">for</span> (i=0; i&lt;nvtxs; i++) {
<a name="l00971"></a>00971     v = perm[i];
<a name="l00972"></a>00972     <span class="keywordflow">if</span> (cmap[v] != cnvtxs) 
<a name="l00973"></a>00973       <span class="keywordflow">continue</span>;
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     u = match[v];
<a name="l00976"></a>00976     <span class="keywordflow">if</span> (ncon == 1)
<a name="l00977"></a>00977       cvwgt[cnvtxs] = vwgt[v];
<a name="l00978"></a>00978     <span class="keywordflow">else</span>
<a name="l00979"></a>00979       icopy(ncon, vwgt+v*ncon, cvwgt+cnvtxs*ncon);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (dovsize)
<a name="l00982"></a>00982       cvsize[cnvtxs] = vsize[v];
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     nedges = 0;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     istart = xadj[v];
<a name="l00987"></a>00987     iend = xadj[v+1];
<a name="l00988"></a>00988     <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l00989"></a>00989       k  = cmap[adjncy[j]];
<a name="l00990"></a>00990       kk = k&amp;mask;
<a name="l00991"></a>00991       <span class="keywordflow">if</span> ((m = htable[kk]) == -1) {
<a name="l00992"></a>00992         cadjncy[nedges] = k;
<a name="l00993"></a>00993         cadjwgt[nedges] = adjwgt[j];
<a name="l00994"></a>00994         htable[kk] = nedges++;
<a name="l00995"></a>00995       }
<a name="l00996"></a>00996       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cadjncy[m] == k) {
<a name="l00997"></a>00997         cadjwgt[m] += adjwgt[j];
<a name="l00998"></a>00998       }
<a name="l00999"></a>00999       <span class="keywordflow">else</span> {
<a name="l01000"></a>01000         <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l01001"></a>01001           <span class="keywordflow">if</span> (cadjncy[jj] == k) {
<a name="l01002"></a>01002             cadjwgt[jj] += adjwgt[j];
<a name="l01003"></a>01003             <span class="keywordflow">break</span>;
<a name="l01004"></a>01004           }
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006         <span class="keywordflow">if</span> (jj == nedges) {
<a name="l01007"></a>01007           cadjncy[nedges] = k;
<a name="l01008"></a>01008           cadjwgt[nedges++] = adjwgt[j];
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     <span class="keywordflow">if</span> (v != u) { 
<a name="l01014"></a>01014       <span class="keywordflow">if</span> (ncon == 1)
<a name="l01015"></a>01015         cvwgt[cnvtxs] += vwgt[u];
<a name="l01016"></a>01016       <span class="keywordflow">else</span>
<a name="l01017"></a>01017         iaxpy(ncon, 1, vwgt+u*ncon, 1, cvwgt+cnvtxs*ncon, 1);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019       <span class="keywordflow">if</span> (dovsize)
<a name="l01020"></a>01020         cvsize[cnvtxs] += vsize[u];
<a name="l01021"></a>01021 
<a name="l01022"></a>01022       istart = xadj[u];
<a name="l01023"></a>01023       iend = xadj[u+1];
<a name="l01024"></a>01024       <span class="keywordflow">for</span> (j=istart; j&lt;iend; j++) {
<a name="l01025"></a>01025         k  = cmap[adjncy[j]];
<a name="l01026"></a>01026         kk = k&amp;mask;
<a name="l01027"></a>01027         <span class="keywordflow">if</span> ((m = htable[kk]) == -1) {
<a name="l01028"></a>01028           cadjncy[nedges] = k;
<a name="l01029"></a>01029           cadjwgt[nedges] = adjwgt[j];
<a name="l01030"></a>01030           htable[kk] = nedges++;
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cadjncy[m] == k) {
<a name="l01033"></a>01033           cadjwgt[m] += adjwgt[j];
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         <span class="keywordflow">else</span> {
<a name="l01036"></a>01036           <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l01037"></a>01037             <span class="keywordflow">if</span> (cadjncy[jj] == k) {
<a name="l01038"></a>01038               cadjwgt[jj] += adjwgt[j];
<a name="l01039"></a>01039               <span class="keywordflow">break</span>;
<a name="l01040"></a>01040             }
<a name="l01041"></a>01041           }
<a name="l01042"></a>01042           <span class="keywordflow">if</span> (jj == nedges) {
<a name="l01043"></a>01043             cadjncy[nedges] = k;
<a name="l01044"></a>01044             cadjwgt[nedges++] = adjwgt[j];
<a name="l01045"></a>01045           }
<a name="l01046"></a>01046         }
<a name="l01047"></a>01047       }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049       <span class="comment">/* Remove the contracted adjacency weight */</span>
<a name="l01050"></a>01050       jj = htable[cnvtxs&amp;mask];
<a name="l01051"></a>01051       <span class="keywordflow">if</span> (jj &gt;= 0 &amp;&amp; cadjncy[jj] != cnvtxs) {
<a name="l01052"></a>01052         <span class="keywordflow">for</span> (jj=0; jj&lt;nedges; jj++) {
<a name="l01053"></a>01053           <span class="keywordflow">if</span> (cadjncy[jj] == cnvtxs) 
<a name="l01054"></a>01054             <span class="keywordflow">break</span>;
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056       }
<a name="l01057"></a>01057       <span class="keywordflow">if</span> (jj &gt;= 0 &amp;&amp; cadjncy[jj] == cnvtxs) { <span class="comment">/* This 2nd check is needed for non-adjacent matchings */</span>
<a name="l01058"></a>01058         cadjncy[jj] = cadjncy[--nedges];
<a name="l01059"></a>01059         cadjwgt[jj] = cadjwgt[nedges];
<a name="l01060"></a>01060       }
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     <span class="keywordflow">for</span> (j=0; j&lt;nedges; j++)
<a name="l01064"></a>01064       htable[cadjncy[j]&amp;mask] = -1;  <span class="comment">/* Zero out the htable */</span>
<a name="l01065"></a>01065     htable[cnvtxs&amp;mask] = -1;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     cnedges += nedges;
<a name="l01068"></a>01068     cxadj[++cnvtxs] = cnedges;
<a name="l01069"></a>01069     cadjncy += nedges;
<a name="l01070"></a>01070     cadjwgt += nedges;
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073   cgraph-&gt;nedges = cnedges;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075   <span class="keywordflow">for</span> (i=0; i&lt;ncon; i++) {
<a name="l01076"></a>01076     cgraph-&gt;tvwgt[i]    = isum(cgraph-&gt;nvtxs, cgraph-&gt;vwgt+i, ncon);
<a name="l01077"></a>01077     cgraph-&gt;invtvwgt[i] = 1.0/(cgraph-&gt;tvwgt[i] &gt; 0 ? cgraph-&gt;tvwgt[i] : 1);
<a name="l01078"></a>01078   }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 
<a name="l01081"></a>01081   <a class="code" href="coarsen_8c.html#ab69ab96ec78174da232dff05e9c79d2f">ReAdjustMemory</a>(ctrl, graph, cgraph);
<a name="l01082"></a>01082 
<a name="l01083"></a>01083   IFSET(ctrl-&gt;dbglvl, <a class="code" href="metis_8h.html#ac50415aa8003f9b7bf0aabb2b0d50877a0b252448586ad17d990c36ffa8ac3439">METIS_DBG_TIME</a>, gk_stopcputimer(ctrl-&gt;ContractTmr));
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   WCOREPOP;
<a name="l01086"></a>01086 }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="comment">/*************************************************************************/</span>
<a name="l01092"></a>01092 <span class="comment">/*************************************************************************/</span>
<a name="l01093"></a><a class="code" href="coarsen_8c.html#a113522304bf628b09d0b69b4db05050e">01093</a> <a class="code" href="structgraph__t.html">graph_t</a> *<a class="code" href="coarsen_8c.html#a113522304bf628b09d0b69b4db05050e">SetupCoarseGraph</a>(<a class="code" href="structgraph__t.html">graph_t</a> *graph, idx_t cnvtxs, idx_t dovsize)
<a name="l01094"></a>01094 {
<a name="l01095"></a>01095   <a class="code" href="structgraph__t.html">graph_t</a> *cgraph;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097   cgraph = <a class="code" href="libmetis_2graph_8c.html#a01903fa912de9fc7f01dace993a3fc85">CreateGraph</a>();
<a name="l01098"></a>01098 
<a name="l01099"></a>01099   cgraph-&gt;nvtxs = cnvtxs;
<a name="l01100"></a>01100   cgraph-&gt;ncon  = graph-&gt;ncon;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   cgraph-&gt;finer  = graph;
<a name="l01103"></a>01103   graph-&gt;coarser = cgraph;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="comment">/* Allocate memory for the coarser graph */</span>
<a name="l01107"></a>01107   cgraph-&gt;xadj     = imalloc(cnvtxs+1, <span class="stringliteral">&quot;SetupCoarseGraph: xadj&quot;</span>);
<a name="l01108"></a>01108   cgraph-&gt;adjncy   = imalloc(graph-&gt;nedges,   <span class="stringliteral">&quot;SetupCoarseGraph: adjncy&quot;</span>);
<a name="l01109"></a>01109   cgraph-&gt;adjwgt   = imalloc(graph-&gt;nedges,   <span class="stringliteral">&quot;SetupCoarseGraph: adjwgt&quot;</span>);
<a name="l01110"></a>01110   cgraph-&gt;vwgt     = imalloc(cgraph-&gt;ncon*cnvtxs, <span class="stringliteral">&quot;SetupCoarseGraph: vwgt&quot;</span>);
<a name="l01111"></a>01111   cgraph-&gt;tvwgt    = imalloc(cgraph-&gt;ncon, <span class="stringliteral">&quot;SetupCoarseGraph: tvwgt&quot;</span>);
<a name="l01112"></a>01112   cgraph-&gt;invtvwgt = rmalloc(cgraph-&gt;ncon, <span class="stringliteral">&quot;SetupCoarseGraph: invtvwgt&quot;</span>);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114   <span class="keywordflow">if</span> (dovsize)
<a name="l01115"></a>01115     cgraph-&gt;vsize = imalloc(cnvtxs,   <span class="stringliteral">&quot;SetupCoarseGraph: vsize&quot;</span>);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   <span class="keywordflow">return</span> cgraph;
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 
<a name="l01121"></a>01121 <span class="comment">/*************************************************************************/</span>
<a name="l01125"></a>01125 <span class="comment">/*************************************************************************/</span>
<a name="l01126"></a><a class="code" href="coarsen_8c.html#ab69ab96ec78174da232dff05e9c79d2f">01126</a> <span class="keywordtype">void</span> <a class="code" href="coarsen_8c.html#ab69ab96ec78174da232dff05e9c79d2f">ReAdjustMemory</a>(<a class="code" href="structctrl__t.html">ctrl_t</a> *ctrl, <a class="code" href="structgraph__t.html">graph_t</a> *graph, <a class="code" href="structgraph__t.html">graph_t</a> *cgraph) 
<a name="l01127"></a>01127 {
<a name="l01128"></a>01128   <span class="keywordflow">if</span> (cgraph-&gt;nedges &gt; 10000 &amp;&amp; cgraph-&gt;nedges &lt; 0.9*graph-&gt;nedges) {
<a name="l01129"></a>01129     cgraph-&gt;adjncy = irealloc(cgraph-&gt;adjncy, cgraph-&gt;nedges, <span class="stringliteral">&quot;ReAdjustMemory: adjncy&quot;</span>);
<a name="l01130"></a>01130     cgraph-&gt;adjwgt = irealloc(cgraph-&gt;adjwgt, cgraph-&gt;nedges, <span class="stringliteral">&quot;ReAdjustMemory: adjwgt&quot;</span>);
<a name="l01131"></a>01131   }
<a name="l01132"></a>01132 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->

</div>
</div>
</div>
</div>
</div>

<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 13 2016 11:04:21 for SEIMS-2016 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="$relpath^doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
